# Лабораторная N 3s 
 
Задание:
разработать клиент-серверную игру, имитирующую сетевую
игру «Рулетка», состоящую из игрового сервера и клиентов.
Основные возможности. Серверное приложение должно реализовывать следующие функции:
1) Прослушивание определенного порта
2) Обработка запросов на подключение по этому порту от клиентов
3) Поддержка одновременной работы нескольких клиентов через механизм нитей
4) Регистрация подключившегося клиента в качестве крупье (один) или
в качестве игрока (несколько)
5) Выдача клиенту (крупье и игроку) списка ставок текущей игры (ставок других игроков)
6) Получение от клиента ставки: суммы ставки и типа ставки (чет, нечет, номер)
7) Получение от крупье команды на начало розыгрыша.
8) Уведомление всех клиентов о результате розыгрыша
9) Обработка запроса на отключение клиента
10) Принудительное отключение клиента 

## Инструкция по использованию

Сборка не требуется, 
roulette_server.py   - сервер
poulette_client.py   - клиент
Сначала запустить файл сервера, потом файл клиента через cmd.

## Описание протокола

Пакеты подразделяются клиентские и серверные
Так же присутствует разделение по типам.
Сообщения типа 0 
Данные пакеты используются для установки и авторизации в приложении. 
Когда сервер запускается, он слушает порт 1234 и клиент когда подключается, требуется сообщить серверу свою роль и ник.

Клиент посылает серверу:

1 байт  | 1 байт | max 20
------- | ------ | -----
тип     | роль   | имя


В данном пакете тип должен равняться 0 так как это установление соединения,  если роль  0 - игрок  роль 1 - крупье. 
Имя должно быть не больше 20 символов потому что большое имя не имеет смысла. 
Сервер в свою очередь должен ответить на это сообщением либо что все хорошо и клиент записан, либо выдать сообщение об ошибке
Сервер отвечает клиенту пакетом: 

1 байт  | 1 байт 
------- | ------ 
тип     | код   

Тип должен быть таким же как и у входящего сообщения, то есть 0.
Код ответа может быть:
0 - все хорошо и клиент записан
1 - крупье уже имеется в игре
2 - такой ник уже существует в игре

После установки соединения, клиент может выполнять команды:
Игрок:
- сделать ставку
- посмотреть баланс
- посмотреть список ставок
Крупье:
- запустить розыгрыш
- посмотреть список ставок

Клиент отправляет серверу:
Сделать ставку:

1 байт  | 1 байт | 2 байта | 1 байт      
------- | ------ | ------- | ----------- 
тип     | код    | ставка  | куда ставка 

Для игровых команд установлен тип 1 везде. Код команды связаный со ставками - 0 
Сама ставка имеет размер 2 байта - short 
Место, на что ставится ставка - 1 байт. число от 0-35 - это ставка на число соответственно. Если указано число 36 - это ставка на четное, если указано число 37 - ставка на нечетное
При установке ставки, сервер сразу списывает очки с игрока. 
Если игрок покидает игру - его ставка удаляется.

1 байт  | 1 байт 
------- | ------ 
тип     | код   

Для просмотра баланса тип должен быть 1 и код 2. 
Для просмотра списка ставок тип должен быть 1 и код 3.
Для запуска игры(только крупье) тип должен быть 1 и код 1.

По входящему сообщению в отдельном потоке сервер определяет, какой именно клиент прислал это сообщение, и в этом же соединении он и отвечает. 
Если это сообщение от крупье о начале игры, сервер отвечает бродкастом. Однако если игру не запустить, сервер ответит только крупье.
Сервер отвечает на выше указанные команды:
Установка ставки:
Если баланс игрока не позволяет сделать ставку(не хватает денег) 
1 байт  | 1 байт | 1 байт    |
------- | ------ | ----------
тип     | код    | код ответа


тип должен быть 1 т.к это команда игры, код должен быть 0, так как это ответ на команду ставки.
Код ответа:
0 - ставка сделана
1 - превышение баланса

Переслать баланс игрока:

1 байт  | 1 байт | 2 байт     
------- | ------ | ---------- 
тип     | код    | баланс    


тип должен быть 1 т.к это команда игры, код должен быть 2, так как это ответ на команду баланса.

Узнать список ставок:

1 байт  | 1 байт | 2 байта | 1 байт      | max 20  
------- | ------ | ------- | ----------- | ------
тип     | код    | ставка  | куда ставка | имя


тип должен быть 1. так как это команда игры, код 3, т.к это ответ на команду списка ставок
Ставка - это значение активной ставки, 
Далее идет поле куда сделана ставка, и ник игрока который поставил ставку.
Сервер  проходится по списку ставок curr_bets и на каждую ставку формирует отдельный пакет и посылает клиенту. 

Запуск игры:

1 байт  | 1 байт | 1 байта     | 1 байт            
------- | ------ | ----------- | --------------- 
тип     | код    | код ответа  | победная клетка 


Тип должен быть 1, код 1, так как это команда запуска игры.
Код ответа:
0 - игра запущена
1 - игра не запущена (либо нет ставок, либо в игре только крупье)
Победная клетка присутствует только в случае когда игра запустилась.
После того как победитель разыгран, сервер проходится по всем ставкам, и проверяет их,
Если ставка сыграла  - начисляет победные очки.
В случае когда ставка на чет нечет -  ставку умножает на два и начисляет этому игроку.
В случае когда ставка на число сыграла - ставка игрока умножается в 5 раз и прибавляется к балансу игрока.

Когда игра закончена, все активные ставки удаляются, и туда могут быть записаны новые ставки. 

Выход -  клиент выходит по команде exit и посылается пустое сообщение, когда пришло пустое сообщение, сервер автоматически удаляет этого клиента и его ставки. 
